@model ShopManager.Models.Product
@{
    ViewData["Title"] = "Detail";
}
<style>
    /* Chrome, Safari, Edge, Opera */
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    /* Firefox */
    input[type=number] {
        -moz-appearance: textfield;
    }
</style>
<!-- Modal Start -->
<div class="modal fade" id="modalAddToCartSuccess" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Thông báo</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Thêm vào giỏ hàng thành công
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
<!-- Modal End -->
<!-- Single Page Header start -->
<div class="container-fluid page-header py-5">
    <h1 class="text-center text-white display-6">Chi tiết sản phẩm</h1>
</div>
<!-- Single Page Header End -->
<!-- Single Product Start -->
<div class="container-fluid py-5 mt-5">
    <div class="container py-5">
        <div class="row g-4 mb-5">
            <!-- Product Detail Start -->
            <div class="col-lg-8 col-xl-9">
                <div class="row g-4">
                    <div class="col-lg-6">
                        <div class="border rounded">
                            <a href="#">
                                <img src="~/Images/SanPham/@Model.Img" class="img-fluid rounded" alt="Image" />
                            </a>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <!-- Text Start -->
                        <h4 class="fw-bold mb-3">@Model.Title</h4>
                        <p class="mb-3">Category: @Model.CategoryTitle</p>
                        <h5 class="fw-bold mb-3">
                            @Model.Price.ToString("#,##0 VND")
                        </h5>
                        <!-- Text End -->
                        <!-- Rating Start -->
                        <div class="d-flex mb-4">
                            @await Component.InvokeAsync("StarRating", new { star = Model.Rate })
                        </div>
                        <!-- Rating End -->

                        <div class="input-group quantity mb-3" style="width: 100px">
                            <div class="input-group-btn">
                                <button class="btn btn-sm btn-minus rounded-circle bg-light border">
                                    <i class="fa fa-minus"></i>
                                </button>
                            </div>
                            <input type="number"
                                   name="quantity"
                                   id="product_detail_quantity"
                                   class="form-control form-control-sm text-center border-0 [&::-webkit-inner-spin-button]:appearance-none"
                                   style="width:30px"
                                   value="1" />
                            <div class="input-group-btn">
                                <button class="btn btn-sm btn-plus rounded-circle bg-light border">
                                    <i class="fa fa-plus"></i>
                                </button>
                            </div>
                        </div>
                        <button onclick="clickAddToCart(@Model.Id,true)" class="btn border border-secondary rounded-pill px-4 py-1 mb-4 text-primary">
                            <i class="fa fa-shopping-bag me-2 text-primary"></i>
                            Thêm vào giỏ hàng
                        </button>
                    </div>
                    <div class="col-lg-12">
                        <nav>
                            <div class="nav nav-tabs mb-3">
                                <button class="nav-link active border-white border-bottom-0"
                                        type="button"
                                        role="tab"
                                        id="nav-about-tab"
                                        data-bs-toggle="tab"
                                        data-bs-target="#nav-about"
                                        aria-controls="nav-about"
                                        aria-selected="true">
                                    Description
                                </button>
                                <button class="nav-link border-white border-bottom-0"
                                        type="button"
                                        role="tab"
                                        id="nav-mission-tab"
                                        data-bs-toggle="tab"
                                        data-bs-target="#nav-mission"
                                        aria-controls="nav-mission"
                                        aria-selected="false">
                                    Reviews
                                </button>
                            </div>
                        </nav>
                        <div class="tab-content mb-5">
                            <!-- Description Start-->
                            <div class="tab-pane active"
                                 id="nav-about"
                                 role="tabpanel"
                                 aria-labelledby="nav-about-tab">

                                <p>
                                    @Model.Content
                                </p>

                            </div>
                            <!-- Description End-->

                            <div class="tab-pane"
                                 id="nav-mission"
                                 role="tabpanel"
                                 aria-labelledby="nav-mission-tab">
                                <div class="d-flex">
                                    <img src="img/avatar.jpg"
                                         class="img-fluid rounded-circle p-3"
                                         style="width: 100px; height: 100px"
                                         alt="" />
                                    <div class="">
                                        <p class="mb-2" style="font-size: 14px">April 12, 2024</p>
                                        <div class="d-flex justify-content-between">
                                            <h5>Jason Smith</h5>
                                            <div class="d-flex mb-3">
                                                <i class="fa fa-star text-secondary"></i>
                                                <i class="fa fa-star text-secondary"></i>
                                                <i class="fa fa-star text-secondary"></i>
                                                <i class="fa fa-star text-secondary"></i>
                                                <i class="fa fa-star"></i>
                                            </div>
                                        </div>
                                        <p>
                                            The generated Lorem Ipsum is therefore always free from repetition
                                            injected humour, or non-characteristic words etc. Susp endisse
                                            ultricies nisi vel quam suscipit
                                        </p>
                                    </div>
                                </div>
                                <div class="d-flex">
                                    <img src="img/avatar.jpg"
                                         class="img-fluid rounded-circle p-3"
                                         style="width: 100px; height: 100px"
                                         alt="" />
                                    <div class="">
                                        <p class="mb-2" style="font-size: 14px">April 12, 2024</p>
                                        <div class="d-flex justify-content-between">
                                            <h5>Sam Peters</h5>
                                            <div class="d-flex mb-3">
                                                <i class="fa fa-star text-secondary"></i>
                                                <i class="fa fa-star text-secondary"></i>
                                                <i class="fa fa-star text-secondary"></i>
                                                <i class="fa fa-star"></i>
                                                <i class="fa fa-star"></i>
                                            </div>
                                        </div>
                                        <p class="text-dark">
                                            The generated Lorem Ipsum is therefore always free from repetition
                                            injected humour, or non-characteristic words etc. Susp endisse
                                            ultricies nisi vel quam suscipit
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane" id="nav-vision" role="tabpanel">
                                <p class="text-dark">
                                    Tempor erat elitr rebum at clita. Diam dolor diam ipsum et tempor sit. Aliqu
                                    diam amet diam et eos labore. 3
                                </p>
                                <p class="mb-0">
                                    Diam dolor diam ipsum et tempor sit. Aliqu diam amet diam et eos labore.
                                    Clita erat ipsum et lorem et sit
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Product Detail End -->
            <!-- Right Panel Start -->
            <div class="col-lg-4 col-xl-3">
                <div class="row g-4 fruite">
                    <div class="col-lg-12">
                        <!-- Search Start -->
                        <div class="input-group w-100 mx-auto d-flex mb-4">
                            <input type="search"
                                   class="form-control p-3"
                                   placeholder="keywords"
                                   aria-describedby="search-icon-1" />
                            <span id="search-icon-1" class="input-group-text p-3">
                                <i class="fa fa-search"></i>
                            </span>
                        </div>
                        <!-- Search End -->
                        @await Component.InvokeAsync("MenuCategory")
                        <!-- Categories End -->
                    </div>

                    <!-- Featured products Start -->
                    <div class="col-lg-12">
                        @await Component.InvokeAsync("FeaturedProducts",new { limit= 5})
                    </div>
                    <!-- Featured products End -->

                </div>
            </div>
            <!-- Right Panel End -->
        </div>

        <!-- Related products Start -->
        @await Component.InvokeAsync("RelatedProducts",
        new{
        idProduct = Model.Id,
        idCategory = Model.CategoryId,
        limit = 9
        })
        <!-- Related products End -->
    </div>
</div>
<!-- Single Product End -->
<script>
    // --------------- AJAX thêm vào giỏ hàng -------------------
    function clickAddToCart(idProduct, hasQuantity) {
        let quantity = 1;
        if (hasQuantity) {
            quantity = document.getElementById("product_detail_quantity").value;
        }

        $.ajax({
            url: '@Url.Action("AddToCart","Cart")',
            data: { id: idProduct, quantity: quantity },
            success: function (data) {
                //Load lại Cart ViewComponent
                $.ajax({
                    url: '@Url.Action("RefreshCartViewComponent","Cart")',
                    success: function (data) {
                        console.log(data)
                        $("#cart_view_component").html(data);
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        console.log(thrownError)
                        alert("Error updating Cart ViewComponent.");
                    }
                });

                // // Hiển thị thông báo thêm thành công
                $("#modalAddToCartSuccess").modal('show');
            },
            error: function (xhr, ajaxOptions, thrownError) {
                //some errror, some show err msg to user and log the error
                alert(xhr.responseText);
            }
        });
    }
</script>
